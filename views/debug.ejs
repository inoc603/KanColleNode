<html>
  <head>
    <title>Listener</title>
    <style type="text/css">
      #exp_now_level,
      #exp_target_level {
        width: 50px;
      }
      #game_div {
        position:relative;
        width:800px;
        height:480px;
        overflow:hidden;
        border-style:solid
      }
      #game_frame {
        position: relative;
        margin: -78px 0px 0px -86px;
      }
      #game_wrapper {
        height: 480;
        overflow: hidden;
        padding-top: 0px;
      }
      #game_panel {
        width: 800;
      }
      .mytab {
        width:60px;
      }
      .exp_next,  
      .ship_type {
        font-size: small;
      }
      .table.expedition_table>tbody>tr:nth-of-type(1)>td,
      .table.build_table>tbody>tr:nth-of-type(1)>td,
      .table.repair_table>tbody>tr:nth-of-type(1)>td,
      .table.fleet_table>tbody>tr:nth-of-type(1)>td {
        border-top: none;
      }
      .table.fleet_table>tbody>tr>td {
        vertical-align: middle;
      }
      .progress.health_bar {
        margin-bottom: 0px;
        height: 10px;
      }
      #repair_panel,
      #battle_panel,
      #general_panel,
      #expedition_panel,
      #game_panel,
      #build_panel,
      #fleet_panel,
      #exp_panel,
      #quest_panel {
        padding: 0px;
      }
      .quest_table>tbody>tr>td {
        font-size: small;
      }
      .quest_table>tbody>tr>td.type {
        width: 10px !important;
      }
      .quest_table>tbody>tr>td.quest_progress {
        width: 20px;
      }
      span.fleet_name_hidden {
        display: none;
      }
      span.fleet_name_shown {
        display: inline;
      }
      html * {
        font-family: 'Microsoft YaHei';
      }
      .btn_wrapper {
        text-align: right;
        display: inline-block;
        width: 80%;
      }
      .panel_title {
        /*width: 17%;*/
        display: inline-block;
      }
      #game_wrapper {
        display: none;
      }
      #battle_panel>.panel-body>table {
        font-size: small;
      }
      .label-caution {
        background-color: yellow;
      }
      th.day_end,
      th.night_end,
      th.day_start,
      td.day_end,
      td.night_end,
      td.day_start {
        width: 100px;
        padding-bottom: 0px !important;
      }
      .battle_table_friendly>tbody>tr>th.name,
      .battle_table_friendly>tbody>tr>td.name,
      .battle_table_enemy>tbody>tr>th.name,
      .battle_table_enemy>tbody>tr>td.name {
        width: 150px;
        padding-bottom: 0px !important; 
      }
      span.status {
        float:right;
      }
      td.time {
        text-align: center;
      }
      #fleet_panel {
        width: 420px;
      }
      #fleet_panel_wrapper {
        display: inline-block;
      }
      .fleet_table {
        overflow: scroll;
      }
/*      #fleet_panel {
        height: 100%;
      }*/
    </style>
    <link rel="stylesheet" href="stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/bootstrap-theme.min.css">
    <link rel="stylesheet" href="stylesheets/bootstrap-formhelpers.min.css">
    <link rel="stylesheet" href="stylesheets/bootstrap-select.min.css">
    <link rel="stylesheet" href="stylesheets/jquery-ui.min.css">
    <link rel="stylesheet" href="stylesheets/jquery-ui.structure.min.css">
    <link rel="stylesheet" href="stylesheets/jquery-ui.theme.min.css">
  </head>
  <body>
    <div class="panel panel-default" id="game_panel">
      <div class="panel-heading">
        <div class="panel_title">Game</div>
        <span class="my_icons" style="float:right;">
          <span class="glyphicon glyphicon-cog" id="config_app" data-toggle="modal" data-target="#setting_modal"></span>&nbsp;
          <span class="glyphicon glyphicon-triangle-bottom"></span>&nbsp;
          <span class="glyphicon glyphicon-refresh" id="refresh_game"></span>
        </span>
        
      </div>
      <div class="panel-body" id="game_wrapper">
        <iframe id="game_frame" scrolling="no" width = "900" height = "1200">
        </iframe>
      </div>
    </div>

    <div class="panel panel-default col-md-11" id="general_panel">
      <div class="panel-heading">
        <div class="panel_title">General Info</div>
        <span class="my_icons" style="float:right;">
          <span class="glyphicon glyphicon-triangle-bottom"></span>
        </span>       
      </div>
      <div class="panel-body">
        <div id="fleet_panel_wrapper">
        <div class="panel panel-default" id="fleet_panel">
          <div class="panel-heading">
            <div class="panel_title">舰队</div>
            <span class="glyphicon glyphicon-triangle-bottom"
                  style="float:right;"></span>
          </div>
          <div class="panel-body">
            <div class="tabable" id="tab_fleet">
              <ul class="nav nav-tabs">
                <li class="fleet_tab active">
                  <a href="#fleet_1" data-toggle="tab">
                    <span class="fleet_num">1</span>&nbsp;
                    <span class="fleet_name_shown"></span>
                  </a>
                </li>
                <li class="fleet_tab">
                  <a href="#fleet_2" data-toggle="tab">
                    <span class="fleet_num">2</span>&nbsp;
                    <span class="fleet_name_hidden"></span>
                  </a>
                </li>
                <li class="fleet_tab">
                  <a href="#fleet_3" data-toggle="tab">
                    <span class="fleet_num">3</span>&nbsp;
                    <span class="fleet_name_hidden"></span>
                  </a>
                </li>
                <li class="fleet_tab">
                  <a href="#fleet_4" data-toggle="tab">
                    <span class="fleet_num">4</span>&nbsp;
                    <span class="fleet_name_hidden"></span>
                  </a>
                </li>
              </ul>
              <div class="tab-content">
                <div class="tab-pane active" id="fleet_1">
                  <div class="fleet_status alert" role="alert">
                    <span class="status_info">No data</span>&nbsp;
                    <span class="status_detail"></span>
                    <span class="status_timer"></span>
                  </div>
                  <table class="table fleet_table">
                    <tbody></tbody>
                  </table>
                </div>
                <div class="tab-pane" id="fleet_2">
                  <div class="fleet_status alert" role="alert">
                    <span class="status_info">No data</span>&nbsp;
                    <span class="status_detail"></span>
                    <span class="status_timer"></span>
                  </div>
                  <table class="table fleet_table">
                    <tbody></tbody>
                  </table>
                </div>
                <div class="tab-pane" id="fleet_3">
                  <div class="fleet_status alert" role="alert">
                    <span class="status_info">No data</span>&nbsp;
                    <span class="status_detail"></span>
                    <span class="status_timer"></span>
                  </div>
                  <table class="table fleet_table">
                    <tbody></tbody>
                  </table>
                </div>
                <div class="tab-pane" id="fleet_4">
                  <div class="fleet_status alert" role="alert">
                    <span class="status_info">No data</span>&nbsp;
                    <span class="status_detail"></span>
                    <span class="status_timer"></span>
                  </div>
                  <table class="table fleet_table">
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- fleet_panel -->
        </div>
        <div class="col-md-2" id="repair_panel_wrapper">
        <div class="panel panel-default" id="repair_panel">
          <div class="panel-heading">
            <div class="panel_title">修理</div>
            <span class="glyphicon glyphicon-triangle-bottom"
                  style="float:right;"></span>
          </div>
          <table class="table repair_table">
            <tbody>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
            </tbody>
          </table>
        </div> <!-- repair_panel -->
        </div>
        <div class="col-md-2" id="expedition_panel_wrapper">
        <div class="panel panel-default" id="expedition_panel">
          <div class="panel-heading">
            <div class="panel_title">远征</div>
            <span class="glyphicon glyphicon-triangle-bottom"
                  style="float:right;"></span>
          </div>
          <table class="table expedition_table">
            <tbody>
              <tr>
                <td id="fleet_2">2</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td id="fleet_3">3</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td id="fleet_4">4</td>
                <td class="time"></td>
              </tr>
            </tbody>
          </table>
        </div> <!-- expedition_panel -->
        </div>
        <div class="col-md-2" id="build_panel_wrapper">
        <div class="panel panel-default" id="build_panel">
          <div class="panel-heading">
            <div class="panel_title">建造</div>
            <span class="glyphicon glyphicon-triangle-bottom"
                  style="float:right;"></span>
          </div>
          <table class="table build_table">
            <tbody>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
              <tr>
                <td class="ship">No data</td>
                <td class="time"></td>
              </tr>
            </tbody>
          </table>
        </div> <!-- build_panel -->
        </div>
        <div class="col-md-4" id="quest_panel_wrapper">
        <div class="panel panel-default" id="quest_panel">
          <div class="panel-heading">
            <div class="panel_title">任务</div>
            <span class="glyphicon glyphicon-triangle-bottom"
                  style="float:right;"></span>
          </div>
          <div class="panel-body">
            <div class="tabable" id="quest_tab">
              <ul class="nav nav-tabs">
                <li><a href="#active_quest" data-toggle="tab">当前</a></li>
                <li><a href="#daily_quest" data-toggle="tab">日常</a></li>
                <li><a href="#weekly_quest" data-toggle="tab">周常</a></li>
                <li><a href="#monthly_quest" data-toggle="tab">月常</a></li>
              </ul>
              <div class="tab-content">
                <div class="tab-pane active" id="active_quest">
                  <table class="table quest_table">
                    <tbody>
                      <tr>
                        <td class="type"></td>
                        <td class="name"></td>
                        <td class="quest_progress"></td>
                      </tr>
                      <tr>
                        <td class="type"></td>
                        <td class="name"></td>
                        <td class="quest_progress"></td>
                      </tr>
                      <tr>
                        <td class="type"></td>
                        <td class="name"></td>
                        <td class="quest_progress"></td>
                      </tr>
                      <tr>
                        <td class="type"></td>
                        <td class="name"></td>
                        <td class="quest_progress"></td>
                      </tr>
                      <tr>
                        <td class="type"></td>
                        <td class="name"></td>
                        <td class="quest_progress"></td>
                      </tr>
                      <tr>
                        <td class="type"></td>
                        <td class="name"></td>
                        <td class="quest_progress"></td>
                      </tr>
                    </tbody>
                  </table>
                </div> <!-- active_quest -->
                <div class="tab-pane" id="daily_quest"></div>
                <div class="tab-pane" id="weekly_quest"></div>
                <div class="tab-pane" id="monthly_quest"></div>
              </div>
            </div>

          </div>
        </div> <!-- quest_panel -->
        </div>
      </div>
    </div>

    <div class="panel panel-default col-md-6" id="battle_panel">
      <div class="panel-heading">
        <div class="panel_title">战斗
          <span id="map"></span><span id="map_point"></span>
        </div>
        <span class="glyphicon glyphicon-triangle-bottom"
              style="float:right;"></span>
      </div>
      <div class="panel-body">
        <div id="no_battle"><p>未出击</p></div>
        <table class="table table-bordered table.condense battle_table_friendly">
          <tbody>
            <!-- (tr>(td[rowspan="7"]>p.fleet_name{fleet_name}+p.formation{formation})+th.name+th.day_start{开始}+th.day_end{昼战}+th.night_end{夜战})+(tr>td.name{name}+(td.day_start>span.hp{100/100}+span.status{状态})+(td.day_end>span.hp{100}+span.status{状态})+(td.night_end>span.hp{100}+span.status{状态}))*6 -->
            <tr>
              <td rowspan="7">
                <p class="fleet_name">fleet_name</p>
                <p class="formation">formation</p>
                <p class="air_fight">
                  stage_1&nbsp;<span class="stage_1"></span>
                  &nbsp;stage_1&nbsp;<span class="stage_2"></span>
                </p>
                <p class="casualty">损伤率&nbsp;<span class="casualty"></span>%</p>
              </td>
              <th class="name"></th>
              <th class="day_start">开始</th>
              <th class="day_end">昼战</th>
              <th class="night_end">夜战</th>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
          </tbody>
        </table>
        <p id="battle_info"><span id="stance"></span></p>
        <p id="peace"></p>
        <table class="table battle_table_enemy">
          <tbody>
            <tr>
              <td rowspan="7">
                <p class="fleet_name">fleet_name</p>
                <p class="formation">formation</p>
                <p class="air_fight">
                  stage_1&nbsp;<span class="stage_1"></span>
                  &nbsp;stage_2&nbsp;<span class="stage_2"></span>
                </p>
                <p class="casualty">损伤率&nbsp;<span class="casualty"></span>%</p>
              </td>
              <th class="name"></th>
              <th class="day_start">开始</th>
              <th class="day_end">昼战</th>
              <th class="night_end">夜战</th>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
            <tr>
              <td class="name">name</td>
              <td class="day_start"><span class="hp">100/100</span><span class="status">状态</span></td>
              <td class="day_end"><span class="hp">100</span><span class="status">状态</span></td>
              <td class="night_end"><span class="hp">100</span><span class="status">状态</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="panel panel-default col-md-4" id="exp_panel">
      <div class="panel-heading">
        <div class="panel_title">经验计算器</div>
        <span class="glyphicon glyphicon-triangle-bottom"
              style="float:right;"></span>
      </div>
      <div class="panel-body">
        <form style="display:inline-block">
          <span>舰娘</span>
          <select class="selectpicker" id="ship_select_picker" data-size="5">
            <option value="a">1</option>
            <option value="a">2</option>
            <option value="a">3</option>
            <option value="a">4</option>
            <option value="a">5</option>
          </select>
          
        </form>
        <button class="btn btn-default" id="update_ship">更新</button>
        <form class="form-inline">
          <span>现在等级</span>
          <input id="exp_now_level" type="text" class="form-control bfh-number" data-min="1" data-max="150">
          <span>exp</span>
          <input type="text" class="form-control" id="exp_now">
        </form>

        <form class="form-inline">
          <span>目标等级</span>
          <input type="text" id="exp_target_level" class="form-control bfh-number" data-min="1" data-max="150">
          <span>exp</span>
          <input type="text" class="form-control" id="exp_target">
        </form>
        
        <form class="form-inline">
          <span>海域</span>
          <select id="map_area">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3" selected="true">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
          <span>-</span>
          <select id="map">
            <option value="1">1</option>
            <option value="2" selected="true">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
          <span>评价</span>
          <select id="rank">
            <option value="s">S</option>
            <option value="a">A</option>
            <option value="b">B</option>
            <option value="c">C</option>
            <option value="d">D</option>
          </select>
          <input type="checkbox" aria-label="..." id="flagship">
          <span>旗舰</span>
          <input type="checkbox" aria-label="..." id="mvp">
          <span>MVP</span>
        </form>

        <hr>
        <span>单次经验</span>&nbsp;<span id="one_turn"></span>
        <br>
        <span>战斗次数</span>&nbsp;<span id="turns_left"></span>
        
      </div>
    </div>



    <div class="modal fade" id="setting_modal" tabindex="-1" role="dialog" 
         aria-labelledby="setting_modal_label" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" 
                    aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="setting_modal_label">设置</h4>
          </div>
          <div class="modal-body">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

  </body>

  <script src="/javascripts/jquery-2.1.3.min.js"></script>
  <script src="/javascripts/jquery-ui.min.js"></script>
  <script src="/javascripts/bootstrap.min.js"></script>
  <script src="/javascripts/bootstrap-formhelpers.js"></script>
  <script src="/javascripts/socket.io.js"></script>
  <script src="/javascripts/bootstrap-select.min.js"></script>
  <script>
    var listener_num = <%= listener_num%>
      , is_bind_to_admiral = false
      , globalFleet = {}
      , globalMixId = ''
      , globalShips = {}
      , gameSrc="http://www.dmm.com/netgame/social/-/gadgets/=/app_id=854854/"
    
    // $('#general_panel').resizable()



    $('a[data-toggle="tab"]' ,'.fleet_tab').on('shown.bs.tab', function (e) {
      $('span:last-child', $(e.target)).attr('class', 'fleet_name_shown')
      $('span:last-child', $(e.relatedTarget)).attr( 'class'
                                                   , 'fleet_name_hidden')
    })

    $(document).ready(function () {
      $('.fleet_tab.active a:first').tab('show')
      $('.status_timer').text('')
      hideBattleInfo()
      $('.panel').draggable({ addClasses: false
                          , handle: 'div.panel-heading'
                          })
      $('#general_panel').resizable()
      $('#fleet_panel').resizable({minWidth:420, alsoResize:'#fleet_panel_wrapper'})
    })

    $('.glyphicon-triangle-bottom').click(function () {
      $panelBody =  $(this).closest('.panel').children('.panel-body')
      if ($panelBody.css('display')=='none')
        $panelBody.show()
      else
        $panelBody.hide()
    })

    $("#refresh_game").click(function () {
      $("#game_frame").attr("src", gameSrc)
    })
  </script>
  <script src="/javascripts/exp-calculator.js"></script>
  <script src="/javascripts/listener.js"></script>
  <script src="/javascripts/socket.js"></script>
</html>